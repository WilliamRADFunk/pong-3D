<html>

<head>
	<title>Pong 3D</title>
	<script src='js/three.js'></script>
	<script src="js/OrbitControls.js"></script>
	<script src='js/keyboard.js'></script>
	<script src='fonts/helvetiker_regular.typeface.js'></script>
</head>

<body>

<script>
	var renderer;
	var scene;
	var camera;
	var orbControls;
	var startTime;
	var WIDTH;
	var HEIGHT;
	var COMPSPEED = 0.055;
	var PLAYERSPEED = 0.04;
	var BALLSPEED = 0.12;
	var xDir = 0.03;
	var yDir = BALLSPEED;
	var scoreObject1, scoreObject2, p1Score = "00", p2Score = "00", p1ScoreOld, p2ScoreOld;
	var crowdCounter = 0;
	var spectator01, spectator02, spectator03, spectator04, spectator05, 
		spectator06, spectator07, spectator08, spectator09, spectator10, 
		spectator11, spectator12, spectator13, spectator14, spectator15, 
		spectator16, spectator17, spectator18, spectator19, spectator20;
	var paddle1, paddle2, ball;
	var explode, one, two, three, four;
	
	// Creates the pong table and the design on top.
	function createPlayBottom()
	{
		var planeGeometry = new THREE.PlaneGeometry( 10, 18, 10, 10 );
		var planeMaterial = new THREE.MeshLambertMaterial( {color: 0x006600} );
		var plane = new THREE.Mesh( planeGeometry, planeMaterial );
		scene.add( plane );

		var centerlineGeometry = new THREE.PlaneGeometry( 9, 0.5, 10, 10 );
		var centerlineMaterial = new THREE.MeshLambertMaterial( {color: 0xFFFFFF} );
		var centerline = new THREE.Mesh( centerlineGeometry, centerlineMaterial );
		centerline.position.z = .02;
		scene.add( centerline );

		var centerCircleGeometry = new THREE.CircleGeometry( 4.0, 50 );
		var centerCircleMaterial = new THREE.MeshLambertMaterial( {color: 0xFFFFFF} );
		var centerCircle = new THREE.Mesh( centerCircleGeometry, centerCircleMaterial );
		centerCircle.position.z = .01;
		scene.add( centerCircle );

		var centerCircleGeometry2 = new THREE.CircleGeometry( 3.5, 50 );
		var centerCircleMaterial2 = new THREE.MeshLambertMaterial( {color: 0x006600} );
		var centerCircle2 = new THREE.Mesh( centerCircleGeometry2, centerCircleMaterial2 );
		centerCircle2.position.z = .015;
		scene.add( centerCircle2 );
	}
	// Creates the sidewalls / audience seating.
	function createBoundingWalls()
	{
		var leftWall1 = new THREE.BoxGeometry( 1, 18, 0.25 );
		var wallMaterial = new THREE.MeshLambertMaterial( {color: 0xBBBBBB} );
		var wall1 = new THREE.Mesh( leftWall1, wallMaterial );
		wall1.position.x = -5;
		wall1.position.z = 0.125;
		scene.add( wall1 );
		
		var edges1 = new THREE.EdgesHelper( wall1, 0x5555555 );
		scene.add( edges1 );

		var leftWall1_2 = new THREE.BoxGeometry( 0.75, 18, 0.25 );
		var wallMaterial = new THREE.MeshLambertMaterial( {color: 0xBBBBBB} );
		var wall1_2 = new THREE.Mesh( leftWall1_2, wallMaterial );
		wall1_2.position.x = -5.125;
		wall1_2.position.z = 0.375;
		scene.add( wall1_2 );
		
		var edges1_2 = new THREE.EdgesHelper( wall1_2, 0x5555555 );
		scene.add( edges1_2 );

		var leftWall1_3 = new THREE.BoxGeometry( 0.5, 18, 0.25 );
		var wallMaterial = new THREE.MeshLambertMaterial( {color: 0xBBBBBB} );
		var wall1_3 = new THREE.Mesh( leftWall1_3, wallMaterial );
		wall1_3.position.x = -5.25;
		wall1_3.position.z = 0.625;
		scene.add( wall1_3 );
		
		var edges1_3 = new THREE.EdgesHelper( wall1_3, 0x5555555 );
		scene.add( edges1_3 );

		var leftWall1_4 = new THREE.BoxGeometry( 0.25, 18, 0.25 );
		var wallMaterial = new THREE.MeshLambertMaterial( {color: 0xBBBBBB} );
		var wall1_4 = new THREE.Mesh( leftWall1_4, wallMaterial );
		wall1_4.position.x = -5.375;
		wall1_4.position.z = 0.875;
		scene.add( wall1_4 );
		
		var edges1_4 = new THREE.EdgesHelper( wall1_4, 0x5555555 );
		scene.add( edges1_4 );
		
		var rightWall1 = new THREE.BoxGeometry( 1, 18, 0.25 );
		var wall2 = new THREE.Mesh( rightWall1, wallMaterial );
		wall2.position.x = 5;
		wall2.position.z = 0.125;
		scene.add( wall2 );

		var edges2 = new THREE.EdgesHelper( wall2, 0x555555 );
		scene.add( edges2 );

		var rightWall2_2 = new THREE.BoxGeometry( 0.75, 18, 0.25 );
		var wallMaterial = new THREE.MeshLambertMaterial( {color: 0xBBBBBB} );
		var wall2_2 = new THREE.Mesh( rightWall2_2, wallMaterial );
		wall2_2.position.x = 5.125;
		wall2_2.position.z = 0.375;
		scene.add( wall2_2 );
		
		var edges2_2 = new THREE.EdgesHelper( wall2_2, 0x5555555 );
		scene.add( edges2_2 );

		var rightWall2_3 = new THREE.BoxGeometry( 0.5, 18, 0.25 );
		var wallMaterial = new THREE.MeshLambertMaterial( {color: 0xBBBBBB} );
		var wall2_3 = new THREE.Mesh( rightWall2_3, wallMaterial );
		wall2_3.position.x = 5.25;
		wall2_3.position.z = 0.625;
		scene.add( wall2_3 );
		
		var edges2_3 = new THREE.EdgesHelper( wall2_3, 0x5555555 );
		scene.add( edges2_3 );

		var rightWall2_4 = new THREE.BoxGeometry( 0.25, 18, 0.25 );
		var wallMaterial = new THREE.MeshLambertMaterial( {color: 0xBBBBBB} );
		var wall2_4 = new THREE.Mesh( rightWall2_4, wallMaterial );
		wall2_4.position.x = 5.375;
		wall2_4.position.z = 0.875;
		scene.add( wall2_4 );
		
		var edges2_4 = new THREE.EdgesHelper( wall2_4, 0x5555555 );
		scene.add( edges2_4 );
	}
	// Creates the player's and the computer's paddles.
	function createPaddles()
	{
		var opponentPaddle = new THREE.BoxGeometry( 2, .5, 1 );
		var oppMaterial = new THREE.MeshLambertMaterial( {color: 0x000066} );
		paddle2 = new THREE.Mesh( opponentPaddle, oppMaterial );
		paddle2.position.y = 9;
		paddle2.position.z = 0.5;
		scene.add( paddle2 );
		
		var edges2 = new THREE.EdgesHelper( paddle2, 0x000000 );
		scene.add( edges2 );
		
		var playerPaddle = new THREE.BoxGeometry( 2, .5, 1 );
		var plMaterial = new THREE.MeshLambertMaterial( {color: 0x660000} );
		paddle1 = new THREE.Mesh( playerPaddle, plMaterial );
		paddle1.position.y = -9;
		paddle1.position.z = 0.5;
		scene.add( paddle1 );
		
		var edges1 = new THREE.EdgesHelper( paddle1, 0x000000 );
		scene.add( edges1 );
	}
	// Creates the pong ball
	function createBall()
	{
		var ballSphere = new THREE.SphereGeometry( 0.3, 50 );
		var ballMaterial = new THREE.MeshLambertMaterial( {color: 0xFFB6C1} );
		ball = new THREE.Mesh( ballSphere, ballMaterial );
		ball.position.z = 0.5;
		scene.add( ball );
	}
	// Moves the ball and paddles. Collision detection determines if point was scored.
	function moveBallAndMaintainPaddles()
	{
	
		ball.position.x += xDir;
		ball.position.y += yDir;
		
		if( Key.isDown( Key.A ) )
		{
			if( !(paddle1.position.x <= -3.5) )
			{
				paddle1.position.x -= PLAYERSPEED;
			}
		}
		else if( Key.isDown( Key.D ) )
		{
			if( !(paddle1.position.x >= 3.5) )
			{
				paddle1.position.x += PLAYERSPEED;
			}
		}
		
		if( ball.position.x <= -4 )
		{
			ball.position.x = -3.9;
			xDir = -xDir;
			three.play();
		}
		else if( ball.position.x >= 4 )
		{
			ball.position.x = 3.9;
			xDir = -xDir;
			four.play();
		}
		var paddleCollisionDetect = Math.abs( paddle2.position.x - ball.position.x );
		if( ball.position.y < -8.5 && yDir < 0 )
		{
			yDir = BALLSPEED;
			
			var paddleCollisionDetect = Math.abs( paddle1.position.x - ball.position.x );
			if( paddleCollisionDetect <= 1.4 )
			{
				if( paddleCollisionDetect >= 0.9 )
				{
					if(paddle1.position.x < ball.position.x)
					{
						xDir = Math.abs(5 * xDir);
						xDir = (xDir >= 0.1) ? 0.1 : 0.08;
					}
					else
					{
						xDir = -Math.abs(5 * xDir);
						xDir = (xDir <= -0.1) ? -0.1 : -0.08;
					}
				}
				else if( paddleCollisionDetect >= 0.4 )
				{
					if(paddle1.position.x < ball.position.x)
					{
						xDir = Math.abs(3 * xDir);
						xDir = (xDir >= 0.05) ? 0.05 : 0.03;
					}
					else
					{
						xDir = -Math.abs(3 * xDir);
						xDir = (xDir <= -0.05) ? -0.05 : -0.03;
					}
				}
				else
				{
					if(paddle1.position.x < ball.position.x)
					{
						xDir = Math.abs(0.8 * xDir);
					}
					else
					{
						xDir = -Math.abs(0.8 * xDir);
					}
				}
				one.play();
			}
			else
			{
				ball.position.x = paddle1.position.x;
				ball.position.y = -8;
				p2Score++;
				var applause = Math.floor((Math.random() * 3) + 1);
				<!-- Sound FX provided by SoundBible.com and were not altered. -->
				switch(applause)
				{
					case 1:
					{
						applause1.play();
						break;
					}
					case 2:
					{
						applause2.play();
						break;
					}
					default:
					{
						applause3.play();
					}
				}
			}
		}
		else if( ball.position.y > 8.5 && yDir > 0 )
		{
			yDir = -BALLSPEED;
			
			if( paddleCollisionDetect <= 1.4 )
			{
				if( paddleCollisionDetect >= 0.9 )
				{
					if(paddle2.position.x < ball.position.x)
					{
						xDir = Math.abs(5 * xDir);
						xDir = (xDir >= 0.1) ? 0.1 : 0.08;
					}
					else
					{
						xDir = -Math.abs(5 * xDir);
						xDir = (xDir <= -0.1) ? -0.1 : -0.08;
					}
				}
				else if( paddleCollisionDetect >= 0.4 )
				{
					if(paddle2.position.x < ball.position.x)
					{
						xDir = Math.abs(3 * xDir);
						xDir = (xDir >= 0.05) ? 0.05 : 0.03;
					}
					else
					{
						xDir = -Math.abs(3 * xDir);
						xDir = (xDir <= -0.05) ? -0.05 : -0.03;
					}
				}
				else
				{
					if(paddle2.position.x < ball.position.x)
					{
						xDir = Math.abs(0.8 * xDir);
					}
					else
					{
						xDir = -Math.abs(0.8 * xDir);
					}
				}
				two.play();
			}
			else
			{
				ball.position.x = paddle2.position.x;
				ball.position.y = 8;
				p1Score++;
				PLAYERSPEED -= 0.002;
				var applause = Math.floor((Math.random() * 3) + 1);
				<!-- Sound FX provided by SoundBible.com and were not altered. -->
				switch(applause)
				{
					case 1:
					{
						applause1.play();
						break;
					}
					case 2:
					{
						applause2.play();
						break;
					}
					default:
					{
						applause3.play();
					}
				}
			}
		}
		if ( paddleCollisionDetect < COMPSPEED )
		{
			paddle2.position.x = ball.position.x;
		}
		else if( (paddle2.position.x < ball.position.x) )
		{
			if( !(paddle2.position.x >= 3.5) )
			{
				paddle2.position.x += COMPSPEED;
			}
		}
		else
		{	
			if( !(paddle2.position.x <= -3.5) )
			{
				paddle2.position.x -= COMPSPEED;
			}
		}
	}
	// Loads sound effects
	function loadSounds()
	{
		applause1 = new Audio('assets/applause1.mp3');
		applause2 = new Audio('assets/applause2.mp3');
		applause3 = new Audio('assets/applause3.mp3');
		one = new Audio('assets/1.mp3');
		two = new Audio('assets/2.mp3');
		three = new Audio('assets/3.mp3');
		four = new Audio('assets/4.mp3');
	}
	// Creates score board and the labels, but not score itself.
	function createScoreBoard()
	{
		var planeGeometry = new THREE.PlaneGeometry( 5, 5, 10, 10 );
		var planeMaterial = new THREE.MeshLambertMaterial( {color: 0xDDDDDD} );
		var scoreBoard1 = new THREE.Mesh( planeGeometry, planeMaterial );
		scoreBoard1.position.x = -8;
		scoreBoard1.position.y = 6;
		scoreBoard1.position.z = 1;
		scoreBoard1.rotation.x = 25 * Math.PI / 180;
		scene.add( scoreBoard1 );

		var planeGeometry = new THREE.PlaneGeometry( 5, 5, 10, 10 );
		var planeMaterial = new THREE.MeshLambertMaterial( {color: 0xDDDDDD} );
		var scoreBoard2 = new THREE.Mesh( planeGeometry, planeMaterial );
		scoreBoard2.position.x = 8;
		scoreBoard2.position.y = 6;
		scoreBoard2.position.z = 1;
		scoreBoard2.rotation.x = 25 * Math.PI / 180;
		scene.add( scoreBoard2 );

		var textGeometry1 = new THREE.TextGeometry("Player Score",
			{
				size: 0.4,
				height: 0.2,
				curveSegments: 10,
				bevelEnabled: false
			});
		var textMaterial1 = new THREE.MeshLambertMaterial( {color: 0xFF0022} );
		var scoreLabel1 = new THREE.Mesh( textGeometry1, textMaterial1 );
		scoreLabel1.position.x = -9.5;
		scoreLabel1.position.y = 7.5;
		scoreLabel1.position.z = 1.8;
		scoreLabel1.rotation.x = 45 * Math.PI / 180;
		scene.add( scoreLabel1 );

		var textGeometry2 = new THREE.TextGeometry("Computer Score",
			{
				size: 0.4,
				height: 0.2,
				curveSegments: 10,
				bevelEnabled: false
			});
		var textMaterial2 = new THREE.MeshLambertMaterial( {color: 0x0022FF} );
		var scoreLabel2 = new THREE.Mesh( textGeometry2, textMaterial2 );
		scoreLabel2.position.x = 6;
		scoreLabel2.position.y = 7.5;
		scoreLabel2.position.z = 1.8;
		scoreLabel2.rotation.x = 45 * Math.PI / 180;
		scene.add( scoreLabel2 );
	}
	// Creates both scores, updating only when a score changes.
	function updateScore()
	{
		scene.remove( scoreObject1 );
		scene.remove( scoreObject2 );

		if(p1Score > 0 && p1Score < 10)
		{
			p1Score = "0" + Number(p1Score);
		}
		if(p2Score > 0 && p2Score < 10)
		{
			p2Score = "0" + Number(p2Score);
		}

		var scoreObjectGeometry1 = new THREE.TextGeometry(p1Score,
		{
			size: 2,
			height: 0.4,
			curveSegments: 10,
			bevelEnabled: false
		});
		var scoreObjectMaterial1 = new THREE.MeshLambertMaterial( {color: 0xFF0022} );
		scoreObject1 = new THREE.Mesh( scoreObjectGeometry1, scoreObjectMaterial1 );
		scoreObject1.position.x = -9.5;
		scoreObject1.position.y = 5;
		scoreObject1.position.z = 0.60;
		scoreObject1.rotation.x = 25 * Math.PI / 180;
		scene.add( scoreObject1 );

		var scoreObjectGeometry2 = new THREE.TextGeometry(p2Score,
		{
			size: 2,
			height: 0.4,
			curveSegments: 10,
			bevelEnabled: false
		});
		var scoreObjectMaterial2 = new THREE.MeshLambertMaterial( {color: 0x0022FF} );
		scoreObject2 = new THREE.Mesh( scoreObjectGeometry2, scoreObjectMaterial2 );
		scoreObject2.position.x = 6.5;
		scoreObject2.position.y = 5;
		scoreObject2.position.z = 0.60;
		scoreObject2.rotation.x = 25 * Math.PI / 180;
		scene.add( scoreObject2 );

		if(p1Score == 10 || p2Score == 10)
		{
			ball.position.x = 0;
			ball.position.y = 0;
			BALLSPEED = 0;
			yDir = 0
			xDir = 0;
		}
	}
	// Creates both scores, updating only when a score changes.
	function createCrowd()
	{
		var yellowMaterial = new THREE.MeshLambertMaterial( {color: 0xFFFF00} );
		var lavenderMaterial = new THREE.MeshLambertMaterial( {color: 0xFF00FF} );
		var cyanMaterial = new THREE.MeshLambertMaterial( {color: 0x00FFFF} );
		var blueMaterial = new THREE.MeshLambertMaterial( {color: 0x0000FF} );
		var greenMaterial = new THREE.MeshLambertMaterial( {color: 0x00FF00} );
		var redMaterial = new THREE.MeshLambertMaterial( {color: 0xFF0000} );

		var boxGeometry = new THREE.BoxGeometry( 0.25, 0.25, 0.25);

		var num1rowRightx = 4.625;
		var num2rowRightx = 4.875;
		var num3rowRightx = 5.125;
		var num1rowLeftx = -4.625;
		var num2rowLeftx = -4.875;
		var num3rowLeftx = -5.125;
		var num4rowLeftx = -5.375

		var num1rowz = 0.375;
		var num2rowz = 0.625;
		var num3rowz = 0.875;
		var num4rowz = 1.125;

		spectator01 = new THREE.Mesh( boxGeometry, redMaterial );
		spectator01.position.x = num3rowLeftx;
		spectator01.position.y = -7;
		spectator01.position.z = num3rowz;
		scene.add( spectator01 );

		spectator02 = new THREE.Mesh( boxGeometry, greenMaterial );
		spectator02.position.x = num3rowRightx;
		spectator02.position.y = 7;
		spectator02.position.z = num3rowz;
		scene.add( spectator02 );

		spectator03 = new THREE.Mesh( boxGeometry, blueMaterial );
		spectator03.position.x = num2rowRightx;
		spectator03.position.y = 2;
		spectator03.position.z = num2rowz;
		scene.add( spectator03 );

		spectator04 = new THREE.Mesh( boxGeometry, cyanMaterial );
		spectator04.position.x = num1rowRightx;
		spectator04.position.y = -5;
		spectator04.position.z = num1rowz;
		scene.add( spectator04 );

		spectator05 = new THREE.Mesh( boxGeometry, cyanMaterial );
		spectator05.position.x = num2rowLeftx;
		spectator05.position.y = 5;
		spectator05.position.z = num2rowz;
		scene.add( spectator05 );

		spectator06 = new THREE.Mesh( boxGeometry, yellowMaterial );
		spectator06.position.x = num4rowLeftx;
		spectator06.position.y = 0;
		spectator06.position.z = num4rowz;
		scene.add( spectator06 );

		spectator07 = new THREE.Mesh( boxGeometry, yellowMaterial );
		spectator07.position.x = num2rowRightx;
		spectator07.position.y = -2;
		spectator07.position.z = num2rowz;
		scene.add( spectator07 );

		spectator08 = new THREE.Mesh( boxGeometry, lavenderMaterial );
		spectator08.position.x = num1rowLeftx;
		spectator08.position.y = -2;
		spectator08.position.z = num1rowz;
		scene.add( spectator08 );
	}
	// Sets up the basics: camera, scene, renderer. Calls constructor methods.
	function init()
	{
		WIDTH = window.innerWidth;
		HEIGHT = window.innerHeight;

		loadSounds();
		
		scene = new THREE.Scene();
	
		camera = new THREE.PerspectiveCamera( 35, WIDTH / HEIGHT, 0.1, 1000 );
		camera.position.x = 0;
		camera.position.y = -25;
		camera.position.z = 10;
		camera.lookAt( scene.position );
		
		renderer = new THREE.WebGLRenderer();
		renderer.setClearColor( 0x000000, 1.0 );
		renderer.setSize( WIDTH, HEIGHT );
		renderer.shadowMapEnabled = true;
	
		// 1. show a plane representing the bottom of the pong table
		createPlayBottom();
		
		// 2. Create sideboards, which will be parallelapipeds
		createBoundingWalls();
		
		// 3. Create the paddles
		createPaddles();
		
		// 4 Create the ball
		createBall();

		// 5 Create the ball
		createScoreBoard();
		
        // add spotlight for the shadows
        var dirLight = new THREE.DirectionalLight( 0xFFFFFF );
        dirLight.position.set( 0, -40, 30 );
        dirLight.shadowCameraNear = 20;
        dirLight.shadowCameraFar = 50;
        dirLight.castShadow = true;
        dirLight.intensity = 2;
        scene.add( dirLight );
		
		document.body.appendChild( renderer.domElement );
		orbControls = new THREE.OrbitControls( camera, renderer.domElement );

		p1ScoreOld = p1Score;
		p2ScoreOld = p2Score;

		updateScore();
		createCrowd();

		render();
	}
	// Render loop continuously updates screen at 60 FPS
	function render()
	{
		moveBallAndMaintainPaddles();
		if(p1Score != p1ScoreOld || p2Score != p2ScoreOld)
		{
			updateScore();
		}
		requestAnimationFrame( render );
		renderer.render( scene, camera );
		p1ScoreOld = p1Score;
		p2ScoreOld = p2Score;
	}
	
	window.onload = init;
</script>

</body>

</html>
